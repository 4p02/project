-- Private types
create table private.users (
    id bigint generated by default as identity primary key unique not null,
    created_at timestamp with time zone null default now(),
    email text unique not null,
    password text not null,
    fullname text not null
);


-- Public types
create type public.article_type as enum('webpage', 'video', 'document');

create table public.documents (
    id bigint generated by default as identity primary key unique not null,
    created_at timestamp with time zone null default now(),
    type article_type not null,
    filename text default null,
    source_url text default null,
    file bytea default null,
    title text default null,
    body bytea default null,
    summary bytea default null
);


create table public.articles (
    id bigint generated by default as identity primary key unique not null,
    owner bigint not null references private.users(id),
    type article_type not null,
    -- array fkeys aren't supported in postgres presently
    -- https://commitfest.postgresql.org/17/1252/
    history bigint[] not null, -- references public.documents(id),
    private boolean not null
);
-- TODO: Add a trigger to delete the history when the article is deleted


create table public.links (
    given_link text not null,
    shortened_link text unique not null
);
